# Defines the services for Render.
# Render will automatically detect this file when you connect the repo.

services:
  # 1. The Web Service (your existing server.js)
  - type: web
    name: auditpulse-web
    env: node
    plan: free # Or 'starter' etc. - This handles fast API requests.
    branch: main
    buildCommand: 'npm install'
    startCommand: 'node server.js'
    envVars:
      - key: NODE_VERSION
        value: 18 # Use a modern Node version
      # Add your SUPABASE_URL, SUPABASE_SERVICE_KEY, etc. here in the Render dashboard
      # Do NOT commit secret keys to this file.

  # 2. The Background Worker (NEW)
  - type: worker
    name: auditpulse-worker
    env: node
    plan: free # Or 'starter' - This handles the long-running jobs.
    branch: main
    buildCommand: 'npm install'
    startCommand: 'node worker.js' # This points to the new file below
    envVars:
      - key: NODE_VERSION
        value: 18
      # Add your SUPABASE_URL, SUPABASE_SERVICE_KEY, etc. here too
